#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import json
from collections import Counter
from pathlib import Path


OUTPUT_PATH = Path(__file__).resolve().parents[1] / "src" / "data" / "questions" / "sports.json"


def make(question: str, answer: str, subtopic: str, difficulty: str) -> dict:
    return {
        "question": question.strip(),
        "answer": answer.strip(),
        "subtopic": subtopic,
        "difficulty": difficulty,
    }


def add_rows(bucket: list[dict], subtopic: str, difficulty: str, rows: list[tuple[str, str]]) -> None:
    for q, a in rows:
        bucket.append(make(q, a, subtopic, difficulty))


def validate_bucket(name: str, bucket: list[dict], expected: dict[str, int]) -> None:
    if len(bucket) != 50:
        raise ValueError(f"{name}: expected 50 questions, got {len(bucket)}")
    counts = Counter(item["difficulty"] for item in bucket)
    if dict(counts) != expected:
        raise ValueError(f"{name}: difficulty mismatch {counts}, expected {expected}")


RULES = "قوانين وتحكيم كرة القدم"
TOURNAMENTS = "بطولات ومنتخبات"
CLUBS = "أندية ولاعبون"
TACTICS = "تكتيك ومراكز"


# ---------------------------------
# 1) قوانين وتحكيم كرة القدم (50)
# distribution: 18 easy / 20 medium / 12 hard
# ---------------------------------
rules: list[dict] = []

rules_easy = [
    ("كم عدد اللاعبين الأساسيين لكل فريق داخل الملعب عند البداية؟", "11 لاعبًا"),
    ("كم مدة الشوط الواحد في كرة القدم؟", "45 دقيقة"),
    ("ما لون البطاقة التي تعني إنذارًا؟", "البطاقة الصفراء"),
    ("ما لون البطاقة التي تعني طردًا مباشرًا؟", "البطاقة الحمراء"),
    ("كم تبعد نقطة الجزاء عن خط المرمى؟", "11 مترًا"),
    ("ما عرض المرمى الرسمي؟", "7.32 متر"),
    ("ما ارتفاع العارضة عن الأرض؟", "2.44 متر"),
    ("هل تُنفّذ رمية التماس بالقدم أم باليدين؟", "بكلتا اليدين"),
    ("من أي مكان يبدأ اللعب بعد تسجيل هدف؟", "من دائرة منتصف الملعب"),
    ("متى يُحتسب الهدف؟", "عند عبور الكرة بكاملها خط المرمى بين القائمين وتحت العارضة"),
    ("إذا خرجت الكرة من خط التماس، كيف يعود اللعب؟", "برمية تماس"),
    ("إذا خرجت الكرة من خط المرمى وآخر من لمسها مهاجم، ما القرار؟", "ركلة مرمى"),
    ("إذا خرجت الكرة من خط المرمى وآخر من لمسها مدافع، ما القرار؟", "ركلة ركنية"),
    ("هل يمكن أن يوجد تسلل مباشر من ركلة ركنية؟", "لا"),
    ("هل يمكن أن يوجد تسلل مباشر من رمية تماس؟", "لا"),
    ("هل يمكن أن يوجد تسلل مباشر من ركلة مرمى؟", "لا"),
    ("كم عدد مساعدي الحكم في الطاقم التحكيمي التقليدي داخل الملعب؟", "مساعدان"),
    ("هل لمس الحارس للكرة بيده مسموح في كل الملعب؟", "لا، داخل منطقة جزائه فقط"),
]
add_rows(rules, RULES, "سهل", rules_easy)

rules_medium = [
    ("كم عدد دقائق الوقت الأصلي للمباراة؟", "90 دقيقة"),
    ("كم مدة الوقت الإضافي في الأدوار الإقصائية إذا استمر التعادل؟", "30 دقيقة"),
    ("ما المسافة القانونية لوقوف الحائط عند الركلة الحرة؟", "9.15 متر"),
    ("ما الحد الأدنى لعدد اللاعبين لاستمرار المباراة لفريق واحد؟", "7 لاعبين"),
    ("كم عدد التغييرات المسموح بها غالبًا في المباريات الحديثة؟", "5 تغييرات"),
    ("في ركلات الترجيح، كم محاولة أساسية لكل فريق قبل الموت المفاجئ؟", "5 محاولات"),
    ("هل يمكن تسجيل هدف مباشر من ضربة البداية؟", "نعم"),
    ("هل يمكن تسجيل هدف مباشر من رمية تماس؟", "لا"),
    ("إذا حصل لاعب على إنذارين في نفس المباراة، ما القرار؟", "الطرد بالبطاقة الحمراء"),
    ("هل يُحسب التسلل لحظة تمرير الكرة أم لحظة استلامها؟", "لحظة تمرير الكرة من الزميل"),
    ("هل يوجد تسلل إذا كان المهاجم داخل نصف ملعبه؟", "لا"),
    ("إذا لمس اللاعب الكرة بيده عمدًا داخل منطقته الدفاعية، ما القرار عادة؟", "ركلة جزاء"),
    ("هل يحق للحكم إضافة وقت بدل ضائع لكل شوط؟", "نعم"),
    ("هل يجوز لمنفذ ركلة الجزاء لمس الكرة مرتين متتاليتين قبل أي لاعب آخر؟", "لا"),
    ("في ركلات الترجيح بعد التعادل في أول 5 محاولات، كيف يتم الحسم؟", "بنظام الموت المفاجئ"),
    ("ما معنى ميزة الحكم (Advantage)؟", "استمرار اللعب رغم المخالفة إذا كانت الفائدة للفريق المتضرر"),
    ("هل يوقف الحكم اللعب فور كل تلامس بسيط؟", "لا، حسب تأثير المخالفة"),
    ("إذا اصطدمت الكرة بالحكم وغيرت مسار الهجمة بشكل واضح، ما الإجراء الحديث؟", "إيقاف اللعب وإسقاط الكرة"),
    ("هل تدخل تقنية VAR في كل لعبة؟", "لا، في الحالات المؤثرة فقط"),
    ("ما الحالات الأربع الأساسية لتدخل VAR؟", "هدف، ركلة جزاء، بطاقة حمراء مباشرة، هوية لاعب خاطئة"),
]
add_rows(rules, RULES, "متوسط", rules_medium)

rules_hard = [
    ("لاعب كان في موقف تسلل لكنه لم يتداخل في اللعب ولم يؤثر على الخصم، هل تُحتسب مخالفة؟", "لا"),
    ("إذا دخلت رمية تماس مباشرة مرمى الخصم دون لمس أحد، ما القرار؟", "لا هدف، وتُحتسب ركلة مرمى"),
    ("إذا دخلت رمية تماس مباشرة مرمى منفذها، ما القرار؟", "ركلة ركنية للفريق الخصم"),
    ("الركلة الحرة غير المباشرة إذا دخلت المرمى مباشرة دون لمس لاعب آخر، ما القرار؟", "لا يُحتسب هدف"),
    ("في ركلات الترجيح، لماذا قد يُطلب من فريق تقليل عدد المنفذين قبل البداية؟", "لمعادلة عدد اللاعبين المؤهلين بين الفريقين"),
    ("إذا تحرك حارس المرمى مبكرًا في ركلة جزاء ولم تدخل الكرة، ما القرار غالبًا؟", "إعادة التنفيذ"),
    ("إذا ارتدت ركلة الجزاء من القائم إلى المنفذ مباشرة ولم يلمسها أحد قبله، ما القرار؟", "مخالفة لمس مزدوج"),
    ("إذا لعب المدافع الكرة لعبًا متعمدًا وذهبت لمهاجم كان متسللًا لحظة التمرير الأصلي، هل تستمر مخالفة التسلل دائمًا؟", "لا دائمًا، لأن اللعب المتعمد يغيّر الحالة"),
    ("لماذا لا يكفي وجود اللاعب في موقف تسلل وحده لاحتساب المخالفة؟", "لازم يتداخل في اللعب أو يؤثر على الخصم"),
    ("إذا تلقى لاعبًا على الدكة بطاقة حمراء، هل يكمل الفريق داخل الملعب بنفس العدد؟", "نعم، لأن المطرود ليس لاعبًا داخل اللعب"),
    ("هل يستطيع الحكم إلغاء قرار بعد مشاهدة VAR إذا ظهرت لقطة أوضح؟", "نعم"),
    ("متى تُعتبر لمسة اليد غير معاقب عليها غالبًا؟", "عندما تكون غير متعمدة والذراع في وضع طبيعي ملاصق للجسم"),
]
add_rows(rules, RULES, "صعب", rules_hard)

validate_bucket(RULES, rules, {"سهل": 18, "متوسط": 20, "صعب": 12})


# ---------------------------------
# 2) بطولات ومنتخبات (50)
# distribution: 17 easy / 20 medium / 13 hard
# ---------------------------------
tournaments: list[dict] = []

tournaments_easy = [
    ("كل كم سنة تُقام كأس العالم لكرة القدم؟", "كل 4 سنوات"),
    ("في أي عام أُقيمت أول نسخة من كأس العالم؟", "1930"),
    ("ما الدولة التي استضافت أول كأس عالم؟", "الأوروغواي"),
    ("ما اسم البطولة القارية لمنتخبات أوروبا؟", "كأس أمم أوروبا (اليورو)"),
    ("ما اسم البطولة القارية لمنتخبات أمريكا الجنوبية؟", "كوبا أمريكا"),
    ("ما اسم البطولة القارية لمنتخبات إفريقيا؟", "كأس الأمم الإفريقية"),
    ("ما المنتخب الأكثر تتويجًا بكأس العالم؟", "البرازيل"),
    ("كم عدد ألقاب البرازيل في كأس العالم؟", "5 ألقاب"),
    ("ما المنتخب الأكثر تتويجًا بكأس الأمم الإفريقية؟", "مصر"),
    ("كم عدد ألقاب مصر في كأس الأمم الإفريقية؟", "7 ألقاب"),
    ("أين أُقيمت كأس العالم 2022؟", "في قطر"),
    ("من بطل كأس العالم 2022؟", "الأرجنتين"),
    ("كم منتخبًا شارك في كأس العالم 2022؟", "32 منتخبًا"),
    ("كم منتخبًا مخطط مشاركته في كأس العالم 2026؟", "48 منتخبًا"),
    ("كم نقطة يحصل عليها الفريق عند الفوز في دور المجموعات؟", "3 نقاط"),
    ("كم نقطة يحصل عليها الفريق عند التعادل؟", "نقطة واحدة"),
    ("كم نقطة يحصل عليها الفريق عند الخسارة؟", "صفر"),
]
add_rows(tournaments, TOURNAMENTS, "سهل", tournaments_easy)

tournaments_medium = [
    ("من بطل كأس العالم 2010؟", "إسبانيا"),
    ("من بطل كأس العالم 2014؟", "ألمانيا"),
    ("من بطل كأس العالم 2018؟", "فرنسا"),
    ("من بطل كأس العالم 2006؟", "إيطاليا"),
    ("من بطل كأس العالم 2002؟", "البرازيل"),
    ("من بطل يورو 2016؟", "البرتغال"),
    ("من بطل يورو 2020؟", "إيطاليا"),
    ("من بطل كوبا أمريكا 2021؟", "الأرجنتين"),
    ("من بطل كأس الأمم الإفريقية 2021؟", "السنغال"),
    ("ما أول دولة إفريقية استضافت كأس العالم؟", "جنوب إفريقيا"),
    ("في مجموعة من 4 منتخبات، كم مباراة يلعب كل منتخب في دور المجموعات؟", "3 مباريات"),
    ("كم فريقًا يشارك في الدور ربع النهائي لأي بطولة إقصائية؟", "8 فرق"),
    ("إذا تساوى فريقان في النقاط بدور المجموعات، ما المعيار الشائع أولًا؟", "فارق الأهداف"),
    ("إذا تعادل منتخب في كل مباريات مجموعته الثلاث، كم نقطة يجمع؟", "3 نقاط"),
    ("منتخب فاز بمباراتين وخسر واحدة في المجموعات، كم نقطة لديه؟", "6 نقاط"),
    ("منتخب فاز بمباراة وتعادل بأخرى وخسر الثالثة، كم نقطة لديه؟", "4 نقاط"),
    ("إذا انتهى النهائي بالتعادل في الوقت الأصلي، ما الخطوة التالية غالبًا؟", "وقت إضافي"),
    ("إذا استمر التعادل بعد الوقت الإضافي في النهائي، كيف يُحسم اللقب؟", "بركلات الترجيح"),
    ("في مباراة إقصائية، هل التعادل يكفي لتأهل الفريقين معًا؟", "لا"),
    ("هل نظام المجموعات يسبق عادة الأدوار الإقصائية في البطولات الكبرى؟", "نعم"),
]
add_rows(tournaments, TOURNAMENTS, "متوسط", tournaments_medium)

tournaments_hard = [
    ("ما الدول التي فازت بكأس العالم 4 مرات حتى قبل نسخة 2026؟", "ألمانيا وإيطاليا"),
    ("ما عدد ألقاب الأرجنتين في كأس العالم بعد نسخة 2022؟", "3 ألقاب"),
    ("في أي عام حققت إنجلترا لقبها الوحيد في كأس العالم؟", "1966"),
    ("في أي عام حققت إسبانيا لقبها الوحيد في كأس العالم؟", "2010"),
    ("ما المنتخب الذي وصل لنهائي كأس العالم 2018 وخسر أمام فرنسا؟", "كرواتيا"),
    ("أي منتخب فاز بكأس العالم كلاعبين تحت اسم ألمانيا الغربية ثم ألمانيا الموحدة؟", "ألمانيا"),
    ("كم منتخبًا يتأهل عادة من مجموعة واحدة في النظام الكلاسيكي لكأس العالم 32 منتخبًا؟", "منتخبان"),
    ("إذا كان نظام مجموعة من 4 فرق، كم مجموع مباريات المجموعة الواحدة؟", "6 مباريات"),
    ("في دوري مجموعات، فريق سجل 7 واستقبل 3. ما فارق أهدافه؟", "+4"),
    ("فريق جمع 5 نقاط من 3 مباريات. ما أحد السيناريوهات الصحيحة؟", "فوز واحد وتعادلان"),
    ("منتخب فاز في 3 مباريات متتالية بدور المجموعات. كم نقطة يحصل؟", "9 نقاط"),
    ("إذا كان فريقان متساويين في النقاط وفارق الأهداف والأهداف المسجلة، ما معيار شائع لاحقًا؟", "نتيجة المواجهة المباشرة"),
    ("ما عدد المباريات في بطولة دورية من 8 منتخبات بنظام كل فريق ضد الآخر مرة واحدة؟", "28 مباراة"),
]
add_rows(tournaments, TOURNAMENTS, "صعب", tournaments_hard)

validate_bucket(TOURNAMENTS, tournaments, {"سهل": 17, "متوسط": 20, "صعب": 13})


# ---------------------------------
# 3) أندية ولاعبون (50)
# distribution: 17 easy / 20 medium / 13 hard
# ---------------------------------
clubs: list[dict] = []

clubs_easy = [
    ("ما جنسية ليونيل ميسي؟", "أرجنتيني"),
    ("ما جنسية كريستيانو رونالدو؟", "برتغالي"),
    ("ما جنسية محمد صلاح؟", "مصري"),
    ("ما جنسية دييغو مارادونا؟", "أرجنتيني"),
    ("ما جنسية بيليه؟", "برازيلي"),
    ("ما جنسية زين الدين زيدان؟", "فرنسي"),
    ("ما جنسية لوكا مودريتش؟", "كرواتي"),
    ("ما جنسية روبرت ليفاندوفسكي؟", "بولندي"),
    ("ما جنسية إيرلينغ هالاند؟", "نرويجي"),
    ("ما جنسية كيليان مبابي؟", "فرنسي"),
    ("ما المباراة التي تجمع ريال مدريد وبرشلونة؟", "الكلاسيكو"),
    ("ما الديربي الذي يجمع ميلان وإنتر؟", "ديربي ميلانو"),
    ("ما الديربي الذي يجمع مانشستر يونايتد ومانشستر سيتي؟", "ديربي مانشستر"),
    ("ماذا يعني هاتريك في كرة القدم؟", "تسجيل لاعب 3 أهداف في مباراة واحدة"),
    ("ما الاسم الإنجليزي للحفاظ على شباك نظيفة؟", "Clean Sheet"),
    ("ما معنى (Assist) في الإحصائيات؟", "تمريرة حاسمة"),
    ("ما القطعة التي يرتديها قائد الفريق للتمييز؟", "شارة القيادة"),
]
add_rows(clubs, CLUBS, "سهل", clubs_easy)

clubs_medium = [
    ("في أي نادي إيطالي لعب مارادونا واشتهر تاريخيًا؟", "نابولي"),
    ("في أي مركز يلعب محمد صلاح غالبًا؟", "جناح"),
    ("من اللاعب المعروف بلقب (الظاهرة)؟", "رونالدو نازاريو"),
    ("في أي نادي إنجليزي حقق كريستيانو رونالدو انطلاقته العالمية الكبرى؟", "مانشستر يونايتد"),
    ("ما النادي الذي لعب له زيدان في إيطاليا قبل ريال مدريد؟", "يوفنتوس"),
    ("أي نادي إسباني يُعرف بلقب النادي الملكي؟", "ريال مدريد"),
    ("أي نادي إسباني يرتبط بلقب النادي الكتالوني؟", "برشلونة"),
    ("ما الديربي الذي يجمع آرسنال وتوتنهام؟", "ديربي شمال لندن"),
    ("ما الديربي الشهير بين بوكا جونيورز وريفر بليت؟", "السوبر كلاسيكو الأرجنتيني"),
    ("ما الديربي التاريخي بين سيلتيك ورينجرز؟", "الأولد فيرم"),
    ("من هو الحارس الإيطالي الشهير الملقب بـ(جيجي)؟", "جيانلويجي بوفون"),
    ("ما جنسية كيفين دي بروين؟", "بلجيكي"),
    ("ما جنسية تشافي هيرنانديز؟", "إسباني"),
    ("ما جنسية أندريس إنييستا؟", "إسباني"),
    ("ما المركز المعتاد للحارس في ترقيم المراكز التقليدي؟", "رقم 1"),
    ("ما المركز المعتاد للمهاجم الصريح في الترقيم التقليدي؟", "رقم 9"),
    ("ما المركز الذي يرتبط تاريخيًا بصانع اللعب الكلاسيكي؟", "رقم 10"),
    ("ما نوع انتقال اللاعب لفترة محددة ثم يعود لناديه الأصلي؟", "إعارة"),
    ("إذا سجل لاعب هدفين في مباراة واحدة، ما الوصف الشائع؟", "ثنائية"),
    ("إذا ساهم لاعب بهدف وتمريرة حاسمة في نفس المباراة، كم مساهمة تهديفية؟", "مساهمتان"),
]
add_rows(clubs, CLUBS, "متوسط", clubs_medium)

clubs_hard = [
    ("لاعب سجل 18 هدفًا وصنع 12 في موسم. كم مساهمته التهديفية؟", "30"),
    ("مهاجم سجل 24 هدفًا في 30 مباراة. ما متوسطه التقريبي للمباراة؟", "0.8 هدف"),
    ("لاعب صنع 15 فرصة محققة وسجل 5 أهداف. كم إجمالي مساهماته المباشرة؟", "20"),
    ("حارس لعب 38 مباراة وخرج بـ19 شباك نظيفة. ما نسبته التقريبية؟", "50%"),
    ("لاعب سجل هاتريك في مباراة ثم ثنائية في التالية. كم هدفًا سجل في المباراتين؟", "5"),
    ("فريق سجّل 68 هدفًا، ولاعب واحد سجّل 17 منها. كم نسبة أهداف اللاعب من أهداف الفريق؟", "25%"),
    ("في سلسلة من 6 مباريات، لاعب سجل في 4 وصنع في 3 دون تكرار المباريات. كم مباراة ساهم فيها؟", "7 مباريات غير ممكنة؛ الحد الأقصى 6"),
    ("لاعب لعب 2700 دقيقة وسجّل 15 هدفًا. كم هدفًا كل 90 دقيقة تقريبًا؟", "0.5 هدف"),
    ("إذا كان لاعب أضاع 3 ركلات جزاء وسجل 9، فما نسبة النجاح؟", "75%"),
    ("لاعب شارك في 40 مباراة كأساسي في 25 ودكة في 15. ما نسبة مشاركاته كأساسي؟", "62.5%"),
    ("فريق فاز 2-1، واللاعب سجّل الهدفين. كم نسبة مساهمته في أهداف فريقه؟", "100%"),
    ("مهاجم سجّل 28 هدفًا في 34 مباراة. ما المتوسط التقريبي؟", "0.82 هدف للمباراة"),
    ("لاعب سجّل 10 وصنع 10، ثم زاد صناعة واحدة كل 5 مباريات خلال 10 مباريات. كم صار عدد الصناعات؟", "12"),
]
add_rows(clubs, CLUBS, "صعب", clubs_hard)

validate_bucket(CLUBS, clubs, {"سهل": 17, "متوسط": 20, "صعب": 13})


# ---------------------------------
# 4) تكتيك ومراكز (50)
# distribution: 18 easy / 20 medium / 12 hard
# ---------------------------------
tactics: list[dict] = []

tactics_easy = [
    ("ماذا يعني التشكيل 4-4-2 بشكل مبسط؟", "4 مدافعين و4 وسط و2 هجوم"),
    ("في تشكيل 4-3-3 كم مهاجمًا أساسيًا يوجد؟", "3"),
    ("في تشكيل 4-2-3-1 كم لاعب ارتكاز أمام الدفاع؟", "2"),
    ("ما دور قلب الدفاع الأساسي؟", "منع فرص الخصم في العمق"),
    ("ما دور الظهير غالبًا؟", "الدفاع على الطرف ودعم الهجوم"),
    ("ما دور لاعب الارتكاز؟", "الربط الدفاعي وقطع الكرات"),
    ("ما دور الجناح؟", "صناعة وعمل فرص من الأطراف"),
    ("ما دور المهاجم الصريح؟", "إنهاء الهجمات وتسجيل الأهداف"),
    ("ماذا يعني الضغط العالي؟", "الضغط على الخصم في مناطقه القريبة من مرماه"),
    ("ماذا يعني التحول الدفاعي؟", "العودة السريعة للدفاع بعد فقد الكرة"),
    ("ماذا يعني التحول الهجومي؟", "الهجوم السريع بعد استخلاص الكرة"),
    ("ماذا نعني بعرض الملعب هجوميًا؟", "تمديد الفريق على الأطراف لخلق مساحات"),
    ("ما الهدف من التمرير القصير المتدرج؟", "السيطرة على الإيقاع وبناء اللعب"),
    ("ما الهدف من الكرات الطولية المباشرة؟", "ضرب الضغط والوصول السريع للثلث الأخير"),
    ("ما اسم الهجمة السريعة بعد افتكاك الكرة؟", "هجمة مرتدة"),
    ("ما الفائدة من التحرك بدون كرة؟", "فتح مساحات لزملاء الفريق"),
    ("ما المقصود بخط التسلل دفاعيًا؟", "تقدم الخط الدفاعي لإيقاع المهاجم في التسلل"),
    ("ما أهمية التمركز الصحيح؟", "تقليل المساحات الخطرة وتحسين الاستحواذ"),
]
add_rows(tactics, TACTICS, "سهل", tactics_easy)

tactics_medium = [
    ("في 4-3-3، كم لاعبًا في خط الوسط؟", "3"),
    ("في 3-5-2، كم قلب دفاع يوجد؟", "3"),
    ("في 4-2-3-1، كم لاعبًا خلف المهاجم الصريح مباشرة؟", "3"),
    ("ما الفرق الرئيسي بين الضغط العالي والضغط المتوسط؟", "منطقة بدء الضغط وقربها من مرمى الخصم"),
    ("متى يُستخدم التكتل الدفاعي المنخفض غالبًا؟", "عند حماية النتيجة أو مواجهة خصم أقوى هجوميًا"),
    ("ما المقصود بالزيادة العددية في طرف الملعب؟", "تفوق عدد لاعبي فريقك في جهة معينة"),
    ("ما معنى اللعب بين الخطوط؟", "استلام الكرة في المساحات بين دفاع ووسط الخصم"),
    ("ما المقصود بعكس اللعب من طرف لآخر؟", "نقل الكرة سريعًا لاستغلال طرف أقل ازدحامًا"),
    ("لماذا يلجأ المدرب لمهاجم وهمي أحيانًا؟", "لسحب قلوب الدفاع وفتح عمق لزملائه"),
    ("ما فائدة الظهير العكسي (Inverted Fullback)؟", "الدخول للعمق للمساندة العددية في الوسط"),
    ("متى يكون الاستحواذ مفيدًا فعلاً؟", "عندما ينتج عنه فرص حقيقية أو تحكم بالمباراة"),
    ("ما خطر الاستحواذ السلبي؟", "فقدان الكرة في مراكز خطرة دون صناعة فرص"),
    ("ما أهم نقطة في الدفاع ضد المرتدات؟", "التوازن الدفاعي ووجود تغطية خلف الكرة"),
    ("لماذا تعتبر المسافة بين الخطوط مهمة دفاعيًا؟", "لتقليل الفراغات وصعوبة التمرير العمودي"),
    ("كيف يكسر الفريق ضغطًا عاليًا من الخصم؟", "بتمرير سريع وتحركات داعمة وتغيير جهة اللعب"),
    ("ما المقصود بالمحاور النصفية (Half-spaces)؟", "المناطق بين العمق والطرف"),
    ("ما دور لاعب المحور في إخراج الكرة من الخلف؟", "تقديم زاوية تمرير آمنة للمدافعين"),
    ("في الحالة الدفاعية، لماذا يعود الجناح لمساندة الظهير؟", "لمنع التفوق العددي على الطرف"),
    ("ما الفرق بين الرقابة رجل لرجل والرقابة بالمنطقة؟", "الأولى تتبع لاعبًا محددًا، والثانية تحمي مساحة"),
    ("ما الهدف التكتيكي من تدوير الكرة في الخلف أحيانًا؟", "جذب ضغط الخصم وخلق مساحات خلفه"),
]
add_rows(tactics, TACTICS, "متوسط", tactics_medium)

tactics_hard = [
    ("فريقك يلعب 4-3-3 وضدك خصم يضغط بثلاثة مهاجمين. أي حل شائع لتسهيل الخروج بالكرة؟", "نزول لاعب وسط بين قلبي الدفاع لتكوين 3 في البناء"),
    ("إذا كان الخصم يدافع بكتلة منخفضة، ما الحل الأنسب غالبًا؟", "تدوير سريع للكرة مع اختراق أنصاف المساحات والكرات العرضية المدروسة"),
    ("ما الخطر الأكبر لرفع خط الدفاع دون ضغط على حامل الكرة؟", "الكرات الطولية خلف المدافعين"),
    ("في التحول الهجومي، لماذا تكون أول تمريرة بعد الافتكاك حاسمة؟", "لأنها تحدد سرعة وكفاءة المرتدة"),
    ("إذا كان فريقك متقدمًا بهدف في الدقائق الأخيرة، ما تعديل تكتيكي شائع؟", "تقليل المخاطرة وزيادة التوازن الدفاعي"),
    ("ما فائدة المثلثات القصيرة على الطرف تحت الضغط؟", "توفير زوايا تمرير مستمرة لكسر الضغط"),
    ("لماذا قد يتحول 4-3-3 إلى 4-5-1 دفاعيًا؟", "لإغلاق الوسط والأطراف بخمسة لاعبي وسط"),
    ("ما الفكرة من ضغط الموجه (Pressing Traps)؟", "دفع الخصم لمنطقة محددة ثم افتكاك الكرة هناك"),
    ("إذا كان المهاجم معزولًا أمام دفاع متكتل، ما الحل الفني؟", "تقريب الخطوط ودعم العمق بلاعب ثالث"),
    ("متى يكون اللعب المباشر أنسب من البناء القصير؟", "عند ضغط شرس مع تفوق خصمك في مناطق البناء"),
    ("كيف تمنع التفوق العددي للخصم في وسط الملعب؟", "بتحريك لاعب إضافي للعمق أو تعديل الرسم التكتيكي"),
    ("ما الفرق العملي بين 4-2-3-1 و4-4-2 بدون كرة؟", "الأولى تبقي صانع اللعب خلف المهاجم، والثانية تضغط عادة بثنائي هجومي على قلبي الدفاع"),
]
add_rows(tactics, TACTICS, "صعب", tactics_hard)

validate_bucket(TACTICS, tactics, {"سهل": 18, "متوسط": 20, "صعب": 12})


# ---------------------------------
# Final merge
# ---------------------------------
questions = []
for i in range(50):
    questions.append(rules[i])
    questions.append(tournaments[i])
    questions.append(clubs[i])
    questions.append(tactics[i])

if len(questions) != 200:
    raise ValueError(f"Expected 200 questions, got {len(questions)}")

difficulty_counts = Counter(item["difficulty"] for item in questions)
expected_difficulty = {"سهل": 70, "متوسط": 80, "صعب": 50}
if dict(difficulty_counts) != expected_difficulty:
    raise ValueError(f"Difficulty mismatch: {difficulty_counts}")

subtopic_counts = Counter(item["subtopic"] for item in questions)
expected_subtopics = {
    RULES: 50,
    TOURNAMENTS: 50,
    CLUBS: 50,
    TACTICS: 50,
}
if dict(subtopic_counts) != expected_subtopics:
    raise ValueError(f"Subtopic mismatch: {subtopic_counts}")

question_texts = [item["question"] for item in questions]
if len(question_texts) != len(set(question_texts)):
    dup_counter = Counter(question_texts)
    duplicates = [text for text, count in dup_counter.items() if count > 1]
    raise ValueError(f"Duplicate questions found: {duplicates[:10]}")

payload = {
    "id": "sports",
    "title": "الرياضة",
    "description": "200 سؤال في كرة القدم فقط (قوانين، بطولات، أندية، تكتيك) مع رفع مستوى الصعوبة إلى 50 سؤال صعب.",
    "questions": questions,
}

OUTPUT_PATH.write_text(json.dumps(payload, ensure_ascii=False, indent=2), encoding="utf-8")

print("Generated:", OUTPUT_PATH)
print("Total:", len(questions))
print("Difficulty:", dict(difficulty_counts))
print("Subtopics:", dict(subtopic_counts))
