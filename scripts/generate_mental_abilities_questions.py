#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import json
from collections import Counter
from pathlib import Path


OUTPUT_PATH = Path(__file__).resolve().parents[1] / "src" / "data" / "questions" / "mental-abilities.json"


def make(question: str, answer: str, subtopic: str, difficulty: str) -> dict:
    return {
        "question": question.strip(),
        "answer": answer.strip(),
        "subtopic": subtopic,
        "difficulty": difficulty,
    }


def add_rows(target: list[dict], subtopic: str, difficulty: str, rows: list[tuple[str, str]]) -> None:
    for question, answer in rows:
        target.append(make(question, answer, subtopic, difficulty))


def round_robin(*groups: list[dict]) -> list[dict]:
    mixed: list[dict] = []
    pointers = [0] * len(groups)

    while True:
        progressed = False
        for i, group in enumerate(groups):
            if pointers[i] < len(group):
                mixed.append(group[pointers[i]])
                pointers[i] += 1
                progressed = True
        if not progressed:
            break

    return mixed


def validate_bucket(name: str, bucket: list[dict]) -> None:
    expected = {"سهل": 10, "متوسط": 20, "صعب": 20}
    counts = Counter(item["difficulty"] for item in bucket)
    if dict(counts) != expected:
        raise ValueError(f"{name}: difficulty mismatch {counts}")
    if len(bucket) != 50:
        raise ValueError(f"{name}: expected 50, got {len(bucket)}")


MENTAL_MATH = "حساب ذهني متقدم"
PATTERNS = "أنماط وتسلسل متقدم"
LOGIC = "منطق واستنتاج"
LANGUAGE = "استدلال لفظي"


# ---------------------------------
# 1) حساب ذهني متقدم (50)
# ---------------------------------
mental_math: list[dict] = []

mental_easy = [
    ("ما ناتج (48 + 37) - 29؟", "56"),
    ("ما ناتج (125 - 68) + 44؟", "101"),
    ("ما ناتج (19 × 6) - 27؟", "87"),
    ("ما ناتج (144 ÷ 12) + 35؟", "47"),
    ("ما ناتج (7 × 8) + (9 × 6)؟", "110"),
    ("ما ناتج 250 - (3 × 47)؟", "109"),
    ("ما ناتج (18 + 22) × 5؟", "200"),
    ("ما ناتج (96 ÷ 8) + (75 ÷ 5)؟", "27"),
    ("ما ناتج (14 × 14) - 65؟", "131"),
    ("ما ناتج (360 ÷ 9) + 17؟", "57"),
]
add_rows(mental_math, MENTAL_MATH, "سهل", mental_easy)

mental_medium = [
    ("إذا كان 35% من عدد يساوي 70، فما العدد؟", "200"),
    ("كم يساوي 12.5% من 320؟", "40"),
    ("متوسط الأعداد 14، 18، 22، 26، س يساوي 20. ما قيمة س؟", "20"),
    ("راتب 2400 زاد 15%. ما الراتب الجديد؟", "2760"),
    ("نسبة البنات إلى البنين 7:5 والمجموع 96. كم عدد البنات؟", "56"),
    ("إذا كان x/3 - 4 = 11، فما x؟", "45"),
    ("إذا كانت 4 صناديق تحتوي 72 قلمًا بالتساوي، فكم قلمًا في 9 صناديق؟", "162"),
    ("سيارة قطعت 180 كم في 3 ساعات. بنفس السرعة، كم تقطع في 5 ساعات؟", "300"),
    ("اشترى شخص 8 دفاتر بسعر 15 للدفتر مع خصم 10% على الإجمالي. كم يدفع؟", "108"),
    ("نصف عدد زائد ثلثه يساوي 25. ما العدد؟", "30"),
    ("إذا كان 2x + 7 = 39، فما x؟", "16"),
    ("ما ناتج (3^3 + 5^2) - 14؟", "38"),
    ("ما ناتج 20% من 450 ثم ناقص 15؟", "75"),
    ("ثمن سلعة بعد خصم 25% أصبح 180. ما ثمنها قبل الخصم؟", "240"),
    ("مجموع عددين 66 والفرق بينهما 18. ما العدد الأكبر؟", "42"),
    ("إذا كان 3/4 من عدد = 48، فما العدد؟", "64"),
    ("سعر كتابين وقلم = 95، وإذا كان سعر الكتاب الواحد 40، فما سعر القلم؟", "15"),
    ("ما ناتج (84 ÷ 7) × (15 - 9)؟", "72"),
    ("إذا كانت السرعة 72 كم/س، فكم المسافة في 25 دقيقة؟", "30"),
    ("إذا كان 40% من عدد أكبر من 24 بمقدار 8، فما العدد؟", "80"),
]
add_rows(mental_math, MENTAL_MATH, "متوسط", mental_medium)

mental_hard = [
    ("إذا كان 2x + 3y = 39 وx + y = 15، فما قيمة x؟", "6"),
    ("إذا كان 2x + 3y = 39 وx + y = 15، فما قيمة y؟", "9"),
    ("قطار قطع 240 كم بسرعة 60 كم/س. كم زمن الرحلة؟", "4 ساعات"),
    ("مستطيل محيطه 54 وطوله 16. ما عرضه؟", "11"),
    ("عدد من رقمين: مجموع الرقمين 11 والآحاد يزيد عن العشرات بـ5. ما العدد؟", "38"),
    ("رأس مال 5000 زاد 12% ثم نقص 10% من القيمة الجديدة. ما القيمة النهائية؟", "5040"),
    ("إذا أنجز 5 عمال عملاً في 12 يومًا، فكم يومًا يحتاج 10 عمال لنفس العمل؟", "6"),
    ("إذا كان x^2 - 9 = 40، فما x الموجب؟", "7"),
    ("ثمن سلعة بعد إضافة ضريبة 5% أصبح 840. ما ثمنها قبل الضريبة؟", "800"),
    ("متوسط 3 اختبارات = 78، ودرجتان منهما 72 و81. ما الدرجة الثالثة؟", "81"),
    ("قرض 12000 بفائدة بسيطة 8% سنويًا لمدة سنتين. كم قيمة الفائدة؟", "1920"),
    ("إذا كان 0.75 من عدد + 10 = 70، فما العدد؟", "80"),
    ("مجموع متتالية حسابية أولها 5 وآخرها 35 وعددها 7. ما المجموع؟", "140"),
    ("كم دقيقة بين 3:20 و6:05؟", "165"),
    ("عدد أقل من 40 إذا قسم على 6 كان الباقي 2، وإذا قسم على 5 كان الباقي 2. ما أكبر عدد يحقق الشرط؟", "32"),
    ("ما ناتج 2^5 + 3^4؟", "113"),
    ("إذا كان 15% من مبلغ يساوي 90، فكم يصبح المبلغ بعد إضافة 30؟", "630"),
    ("سعر سلعة 1000 بعد خصمين متتاليين 10% ثم 20%. كم السعر النهائي؟", "720"),
    ("حل المعادلة: 3(x - 2) = 2(x + 5)", "16"),
    ("إذا كان الفرق بين عددين 24 ومجموعهما 96، فما العدد الأصغر؟", "36"),
]
add_rows(mental_math, MENTAL_MATH, "صعب", mental_hard)

validate_bucket(MENTAL_MATH, mental_math)


# ---------------------------------
# 2) أنماط وتسلسل متقدم (50)
# ---------------------------------
patterns: list[dict] = []

patterns_easy = [
    ("أكمل النمط: 4، 9، 14، 19، ؟", "24"),
    ("أكمل النمط: 3، 6، 12، 24، ؟", "48"),
    ("أكمل النمط: 100، 90، 81، 73، ؟", "66"),
    ("أكمل النمط: 2، 5، 10، 17، 26، ؟", "37"),
    ("أكمل النمط: 1، 4، 9، 16، 25، ؟", "36"),
    ("أكمل النمط: 5، 10، 20، 40، ؟", "80"),
    ("أكمل النمط: 7، 14، 13، 26، 25، ؟", "50"),
    ("أكمل النمط: 30، 27، 24، 21، ؟", "18"),
    ("أكمل النمط: 2، 3، 5، 8، 12، ؟", "17"),
    ("أكمل النمط: 81، 27، 9، 3، ؟", "1"),
]
add_rows(patterns, PATTERNS, "سهل", patterns_easy)

patterns_medium = [
    ("أكمل النمط: 1، 2، 6، 24، 120، ؟", "720"),
    ("أكمل النمط: 3، 7، 15، 31، ؟", "63"),
    ("أكمل النمط: 2، 4، 7، 11، 16، ؟", "22"),
    ("أكمل النمط: 50، 45، 37، 26، ؟", "12"),
    ("أكمل النمط: 1، 8، 27، 64، ؟", "125"),
    ("أكمل النمط: 2، 5، 11، 23، 47، ؟", "95"),
    ("أكمل النمط: 13، 21، 34، 55، ؟", "89"),
    ("أكمل النمط: 4، 6، 10، 18، 34، ؟", "66"),
    ("أكمل النمط: 9، 18، 16، 32، 30، ؟", "60"),
    ("أكمل النمط: 1، 3، 7، 13، 21، ؟", "31"),
    ("أكمل النمط: 40، 20، 24، 12، 16، 8، ؟", "12"),
    ("أكمل النمط: 6، 11، 21، 41، 81، ؟", "161"),
    ("أكمل النمط: 2، 6، 12، 20، 30، ؟", "42"),
    ("أكمل النمط: 1، 5، 14، 30، 55، ؟", "91"),
    ("أكمل النمط: 7، 10، 16، 25، 37، ؟", "52"),
    ("أكمل النمط: 100، 98، 94، 88، 80، ؟", "70"),
    ("أكمل النمط: 3، 12، 27، 48، 75، ؟", "108"),
    ("أكمل النمط: 2، 3، 6، 11، 18، 27، ؟", "38"),
    ("أكمل النمط: 8، 4، 12، 6، 18، 9، ؟", "27"),
    ("أكمل النمط: 5، 9، 17، 33، 65، ؟", "129"),
]
add_rows(patterns, PATTERNS, "متوسط", patterns_medium)

patterns_hard = [
    ("أكمل النمط: 2، 10، 12، 60، 62، 310، ؟", "312"),
    ("أكمل النمط: 1، 2، 4، 7، 11، 16، 22، ؟", "29"),
    ("أكمل النمط: 6، 28، 66، 120، 190، ؟", "276"),
    ("أكمل النمط: 1، 4، 10، 22، 46، 94، ؟", "190"),
    ("أكمل النمط: 3، 5، 9، 17، 33، 65، ؟", "129"),
    ("أكمل النمط: 4، 18، 48، 100، 180، 294، ؟", "448"),
    ("أكمل النمط: 11، 13، 17، 23، 31، 41، ؟", "53"),
    ("أكمل النمط: 5، 6، 8، 11، 15، 20، ؟", "26"),
    ("أكمل النمط: 81، 64، 49، 36، 25، ؟", "16"),
    ("أكمل النمط: 2، 9، 28، 65، 126، ؟", "217"),
    ("أكمل النمط: 1، 2، 5، 14، 41، ؟", "122"),
    ("أكمل النمط: 3، 4، 7، 12، 19، 28، ؟", "39"),
    ("أكمل النمط: 10، 30، 68، 130، 222، ؟", "350"),
    ("أكمل النمط: 4، 9، 19، 39، 79، ؟", "159"),
    ("أكمل النمط: 7، 21، 20، 60، 59، 177، ؟", "176"),
    ("أكمل النمط: 2، 3، 5، 9، 17، 33، ؟", "65"),
    ("أكمل النمط: 100، 50، 52، 26، 28، 14، ؟", "16"),
    ("أكمل النمط: 1، 1، 2، 6، 24، 120، ؟", "720"),
    ("أكمل النمط: 9، 7، 10، 8، 11، 9، ؟", "12"),
    ("أكمل النمط: 15، 14، 12، 9، 5، ؟", "0"),
]
add_rows(patterns, PATTERNS, "صعب", patterns_hard)

validate_bucket(PATTERNS, patterns)


# ---------------------------------
# 3) منطق واستنتاج (50)
# ---------------------------------
logic: list[dict] = []

logic_easy = [
    ("إذا كان سامي أعلى درجة من مروان، ومروان أعلى من باسم، فمن الأقل درجة؟", "باسم"),
    ("إذا كانت كل الأنظمة السحابية تحتاج إنترنت، وهذا النظام سحابي، فهل يحتاج إنترنت؟", "نعم"),
    ("إذا كان لا طالب في المجموعة A متأخرًا، وأحمد من A، فهل أحمد متأخر؟", "لا"),
    ("إذا كان الجهاز X أسرع من Y وY أسرع من Z، فمن الأسرع؟", "X"),
    ("إذا جلس رامي بين علي وسيف، فمن في المنتصف؟", "رامي"),
    ("إذا كانت كل الملفات المؤرشفة مضغوطة، والملف F غير مضغوط، فهل F مؤرشف؟", "لا"),
    ("إذا كان كل مشروع ناجح يلتزم بالخطة، وهذا المشروع لم يلتزم بالخطة، فهل هو ناجح وفق المعطيات؟", "لا"),
    ("إذا كان اليوم بعد غد هو الخميس، فما اليوم؟", "الثلاثاء"),
    ("إذا كان ترتيب المتسابقين: كريم ثم شريف ثم نادر، فمن الثاني؟", "شريف"),
    ("إذا كان كل عنصر في المجموعة B موجبًا، والعدد -3 ليس موجبًا، فهل -3 ينتمي إلى B؟", "لا"),
]
add_rows(logic, LOGIC, "سهل", logic_easy)

logic_medium = [
    ("في طابور من 5 أشخاص: هند قبل منى، ومنى قبل سارة، وليلى بعد سارة، ونور بين هند ومنى. من الأخيرة؟", "ليلى"),
    ("في سباق: تامر قبل هاني وبعد عادل، ومازن بعد هاني. من الثاني؟", "تامر"),
    ("أربعة مقاعد متتالية: A يسار B مباشرة، C يمين B مباشرة، D في الطرف الأيمن. من في المقعد الثاني؟", "B"),
    ("إذا كان كل محلل بيانات يجيد الإحصاء، وبعض من يجيد الإحصاء لا يجيد البرمجة، هل نستنتج أن كل محلل بيانات لا يجيد البرمجة؟", "لا"),
    ("إذا كان لا شيء من الكتب الرقمية ورقيًا، وملف X ورقي، فهل X كتاب رقمي؟", "لا"),
    ("إذا كانت جميع الأجهزة الذكية تتصل بالشبكة، وجهاز K لا يتصل بالشبكة، فهل K جهاز ذكي وفق المعطيات؟", "لا"),
    ("إذا كان اليوم الأحد، فما اليوم بعد 17 يومًا؟", "الأربعاء"),
    ("إذا بدأ اجتماع 09:35 وانتهى 11:05، ما المدة بالدقائق؟", "90"),
    ("إذا كانت 3 فرق، وكل فريق لعب مع الآخرين مرة واحدة، كم مباراة إجماليًا؟", "3"),
    ("إذا صافح 8 أشخاص بعضهم مرة واحدة، كم عدد المصافحات؟", "28"),
    ("في درج 4 أقلام حمراء و4 زرقاء، ما أقل عدد سحب دون إرجاع لضمان قلمين من نفس اللون؟", "3"),
    ("لديك 3 مفاتيح واحد فقط يفتح الباب. في أسوأ حالة، كم محاولة تحتاج؟", "3"),
    ("زاويتان متتامتان مجموعهما 90، الأولى 37. ما الثانية؟", "53"),
    ("إذا كان كل A هو B، وكل B هو C، فما النتيجة؟", "كل A هو C"),
    ("إذا كان بعض C هو D، وبعض D هو E، هل يلزم أن بعض C هو E؟", "لا"),
    ("مجموع عددين 150 والفرق 30. ما العدد الأكبر؟", "90"),
    ("في جدول أسبوعي: تدريب يومي ما عدا الجمعة. كم يوم تدريب في أسبوعين؟", "12"),
    ("إذا تحركت 3 خطوات للأمام وخطوتين للخلف وكررت ذلك 5 مرات، ما صافي التقدم؟", "5"),
    ("رمز قفل من 4 أرقام وكل رقم مختلف. هل 1123 رمز صحيح وفق الشرط؟", "لا"),
    ("متوسط 4 درجات = 85، وثلاث درجات هي 80 و90 و88. ما الدرجة الرابعة؟", "82"),
]
add_rows(logic, LOGIC, "متوسط", logic_medium)

logic_hard = [
    ("ثلاثة أشخاص: أ، ب، ج. شخص واحد فقط صادق. أ: ب كاذب. ب: ج كاذب. ج: أ وب كاذبان. من الصادق؟", "ب"),
    ("أربعة مقاعد: C في الطرف الأيسر، A ليس في الطرفين، B يمين A مباشرة، D يسار A. من في المقعد الرابع؟", "B"),
    ("في ترتيب من 1 إلى 5: رنا قبل منى، منى قبل سمر، ليلى بعد سمر، وهبة قبل رنا. من في المركز الثالث؟", "منى"),
    ("إذا كان كل من يحل المسألة الأولى يحل الثانية، ولا أحد من مجموعة X حل الثانية، فهل حل أحدهم الأولى؟", "لا"),
    ("إذا كانت العبارة (إما A أو B حصريًا) صحيحة وA صحيحة، فماذا عن B؟", "خاطئة"),
    ("عدد صحيح موجب أقل من 10 ومضاعف لـ3 و5 معًا. ما العدد؟", "لا يوجد"),
    ("في صندوق 6 بيضاء و4 سوداء، ما أقل سحب لضمان كرتين سوداوين؟", "8"),
    ("في سباق 6 متسابقين، إذا كان عمر قبل فادي بثلاثة مراكز وفادي خامسًا، فما مركز عمر؟", "الثاني"),
    ("إذا كان اليوم الأربعاء، فما اليوم بعد 100 يوم؟", "الجمعة"),
    ("اجتماع يبدأ 13:40 وينتهي 16:25 مع استراحة 20 دقيقة. ما زمن العمل الفعلي بالدقائق؟", "145"),
    ("لديك مفتاحان أحدهما صحيح. باحتمال متساوٍ، ما متوسط عدد المحاولات لفتح الباب؟", "1.5"),
    ("إذا كان بعض المبرمجين مصممين، وكل المصممين مبدعون، هل بعض المبرمجين مبدعون؟", "نعم"),
    ("إذا كانت جميع التقارير المعتمدة موقعة، وهذا التقرير غير موقع، فما الاستنتاج المؤكد؟", "غير معتمد"),
    ("ثلاث صناديق بعناوين خاطئة: تفاح، برتقال، تفاح وبرتقال. سحبت برتقالة من صندوق (تفاح وبرتقال). ما المحتوى الحقيقي لهذا الصندوق؟", "برتقال"),
    ("عدد من رقمين: العشرات أكبر من الآحاد بـ2 ومجموعهما 10. ما العدد؟", "64"),
    ("في فريق: كل لاعب أساسي يشارك، وبعض المشاركين ليسوا أساسيين. هل كل المشاركين أساسيون؟", "لا"),
    ("إذا كانت عبارة (ليس كل A هم B) صحيحة، فما العبارة المكافئة؟", "بعض A ليسوا B"),
    ("إذا كان احتمال حدث = 0 في النموذج، هل يمكن وقوعه داخل النموذج؟", "لا"),
    ("خمسة كتب 1..5: الكتاب 5 في الطرف الأيمن، والكتاب 1 يسار 3 مباشرة، والكتاب 2 بين 3 و5. ما الترتيب الكامل؟", "4،1،3،2،5"),
    ("إذا كانت (A ⇒ B) صحيحة وB خاطئة، فماذا عن A؟", "خاطئة"),
]
add_rows(logic, LOGIC, "صعب", logic_hard)

validate_bucket(LOGIC, logic)


# ---------------------------------
# 4) استدلال لفظي (50)
# ---------------------------------
language: list[dict] = []

language_easy = [
    ("ما عكس كلمة (مؤقت)؟", "دائم"),
    ("ما عكس كلمة (ندرة)؟", "وفرة"),
    ("ما مرادف كلمة (منهجي)؟", "منظم"),
    ("ما عكس كلمة (غامض)؟", "واضح"),
    ("ما مرادف كلمة (دقيق)؟", "محكم"),
    ("ما عكس كلمة (متفائل)؟", "متشائم"),
    ("ما مرادف كلمة (مقنع)؟", "وجيه"),
    ("ما عكس كلمة (توسع)؟", "انكماش"),
    ("ما مرادف كلمة (استنتاج)؟", "استخلاص"),
    ("ما عكس كلمة (مرونة)؟", "جمود"),
]
add_rows(language, LANGUAGE, "سهل", language_easy)

language_medium = [
    ("أكمل العلاقة: طبيب : مستشفى = معلم : ؟", "مدرسة"),
    ("أكمل العلاقة: مهندس : تصميم = كاتب : ؟", "تأليف"),
    ("أكمل العلاقة: مفتاح : قفل = كلمة مرور : ؟", "حساب"),
    ("أكمل العلاقة: بوصلة : اتجاه = ساعة : ؟", "وقت"),
    ("أكمل العلاقة: خريطة : طريق = جدول : ؟", "زمن"),
    ("أكمل العلاقة: بذرة : شجرة = فكرة : ؟", "مشروع"),
    ("أكمل العلاقة: تدريب : مهارة = مراجعة : ؟", "إتقان"),
    ("أكمل العلاقة: سؤال : إجابة = مشكلة : ؟", "حل"),
    ("أكمل العلاقة: حرارة : تمدد = برودة : ؟", "انكماش"),
    ("أكمل العلاقة: دستور : دولة = لوائح : ؟", "مؤسسة"),
    ("في جملة: (اتخذ قرارًا حاسمًا). ما مرادف (حاسمًا)؟", "نهائيًا"),
    ("في جملة: (التحليل السليم يمنع التسرع). ما عكس (السليم)؟", "المعيب"),
    ("اختر الكلمة المختلفة: برهان، دليل، حجة، مصادفة", "مصادفة"),
    ("اختر الكلمة المختلفة: فرضية، تجربة، نتيجة، نافذة", "نافذة"),
    ("أي التعبيرين أدق: (بيانات موثقة) أم (بيانات عشوائية) عند بناء قرار؟", "بيانات موثقة"),
    ("أكمل: لا يُبنى الحكم على ... واحدة", "حالة"),
    ("في عبارة: (النقد البنّاء). ما معنى (بنّاء)؟", "يهدف للتحسين"),
    ("اختر الكلمة الأقرب لمعنى (موضوعي): محايد أم مندفع؟", "محايد"),
    ("اختر الكلمة الأقرب لعكس (منطقي): عبثي أم متسق؟", "عبثي"),
    ("أكمل: جودة الفكرة تظهر عند قوة ...", "الدليل"),
]
add_rows(language, LANGUAGE, "متوسط", language_medium)

language_hard = [
    ("أي عبارة مكافئة منطقيًا لـ(ليس كل الحلول صحيحة)؟", "بعض الحلول غير صحيحة"),
    ("أي عبارة مكافئة لـ(جميع المشاركين ناجحون)؟", "إذا كان الشخص غير ناجح فهو غير مشارك"),
    ("في جملة: (رغم قلة الوقت، حافظ الفريق على الدقة). ما الرسالة الضمنية؟", "ضغط الوقت لا يبرر الخطأ"),
    ("في جملة: (تعددت الآراء واتحد القرار). ما الذي يفهم؟", "النقاش سبق الحسم"),
    ("ما الأدق لغويًا: (البيانات تؤكد الفرضية) أم (الفرضية تؤكد البيانات)؟", "البيانات تؤكد الفرضية"),
    ("اختر اللفظ غير المنتمي: تحليل، تفكيك، تمحيص، تبذير", "تبذير"),
    ("أكمل العلاقة المركبة: مقدمة : نتيجة = معطيات : ؟", "استنتاج"),
    ("إذا كانت عبارة (قد ينجح المشروع بشرط التخطيط) ما شرط النجاح المذكور؟", "التخطيط"),
    ("في عبارة: (السرعة بلا دقة خسارة مضاعفة). ما المعنى الأقرب؟", "الجودة أولى من العجلة"),
    ("أي صياغة أدق: (احتمال وارد) أم (يقين مطلق) عندما الدليل غير كافٍ؟", "احتمال وارد"),
    ("أكمل: قوة الحجة لا تُقاس بحدة الصوت بل بوضوح ...", "المنطق"),
    ("في نص: (لم يرفض الفكرة بل طلب إعادة صياغتها). ما الموقف الحقيقي؟", "قبول مشروط بالتحسين"),
    ("ما العبارة المكافئة لـ(لا يوجد قرار بلا تبعات)؟", "كل قرار له تبعات"),
    ("اختر الأدق: (تعميم من حالة واحدة) أم (استنتاج من عينة كافية)؟", "استنتاج من عينة كافية"),
    ("في جملة: (عاد للنقطة الأساسية بعد تشعب النقاش). ما المهارة المشار إليها؟", "إدارة الحوار"),
    ("أكمل: عندما يتعارض الرأي مع الدليل، تُقدَّم ...", "الحقائق"),
    ("أي العبارة أدق منطقيًا: (الاستثناء لا ينقض القاعدة) أم (الاستثناء يثبت القاعدة دائمًا)؟", "الاستثناء لا ينقض القاعدة"),
    ("في عبارة: (سؤال صحيح نصف الإجابة). ما المعنى؟", "صياغة السؤال تحدد جودة الحل"),
    ("اختر اللفظ الأقرب لمعنى (تحقق): تدقيق أم تخمين؟", "تدقيق"),
    ("ما الأنسب لحسم خلاف معرفي: (الانطباع) أم (المصدر الموثوق)؟", "المصدر الموثوق"),
]
add_rows(language, LANGUAGE, "صعب", language_hard)

validate_bucket(LANGUAGE, language)


# ---------------------------------
# Final assembly
# ---------------------------------
questions = round_robin(mental_math, patterns, logic, language)

if len(questions) != 200:
    raise ValueError(f"Expected 200 questions, got {len(questions)}")

difficulty_counts = Counter(item["difficulty"] for item in questions)
expected_difficulty = {"سهل": 40, "متوسط": 80, "صعب": 80}
if dict(difficulty_counts) != expected_difficulty:
    raise ValueError(f"Difficulty mismatch: {difficulty_counts}")

subtopic_counts = Counter(item["subtopic"] for item in questions)
expected_subtopics = {
    MENTAL_MATH: 50,
    PATTERNS: 50,
    LOGIC: 50,
    LANGUAGE: 50,
}
if dict(subtopic_counts) != expected_subtopics:
    raise ValueError(f"Subtopic mismatch: {subtopic_counts}")

question_texts = [item["question"] for item in questions]
if len(question_texts) != len(set(question_texts)):
    dup_counter = Counter(question_texts)
    duplicates = [text for text, count in dup_counter.items() if count > 1]
    raise ValueError(f"Duplicate questions found: {duplicates[:10]}")

payload = {
    "id": "mental-abilities",
    "title": "القدرات الذهنية",
    "description": "200 سؤال قدرات ذهنية بمستوى أعلى (حساب ذهني متقدم، أنماط وتسلسل متقدم، منطق واستنتاج، واستدلال لفظي).",
    "questions": questions,
}

OUTPUT_PATH.write_text(json.dumps(payload, ensure_ascii=False, indent=2), encoding="utf-8")

print("Generated:", OUTPUT_PATH)
print("Total:", len(questions))
print("Difficulty:", dict(difficulty_counts))
print("Subtopics:", dict(subtopic_counts))
